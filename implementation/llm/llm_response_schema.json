{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "RemDarwin LLM Trade Analysis Response Schema",
  "description": "Structured JSON schema for LLM responses in options trading decision support",
  "type": "object",
  "properties": {
    "trade_id": {
      "type": "string",
      "description": "Unique identifier for the trade analysis request"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of the analysis"
    },
    "analysis_confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "Overall confidence score in the analysis (0.0 to 1.0)"
    },
    "trade_rationale": {
      "type": "object",
      "properties": {
        "primary_catalyst": {
          "type": "string",
          "description": "Main market catalyst driving the trade opportunity"
        },
        "market_context": {
          "type": "string",
          "description": "Current market regime and conditions"
        },
        "fundamental_factors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Key fundamental drivers supporting the trade"
        },
        "technical_factors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Technical indicators and patterns considered"
        },
        "narrative_summary": {
          "type": "string",
          "description": "Cohesive explanation of why this trade makes sense now"
        }
      },
      "required": ["primary_catalyst", "market_context", "narrative_summary"]
    },
    "risk_assessment": {
      "type": "object",
      "properties": {
        "overall_risk_level": {
          "type": "string",
          "enum": ["LOW", "MODERATE", "HIGH", "EXTREME"],
          "description": "Aggregate risk rating"
        },
        "risk_factors": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "factor": {
                "type": "string",
                "description": "Specific risk factor"
              },
              "probability": {
                "type": "string",
                "enum": ["LOW", "MEDIUM", "HIGH"],
                "description": "Likelihood of occurrence"
              },
              "impact": {
                "type": "string",
                "enum": ["LOW", "MEDIUM", "HIGH"],
                "description": "Potential magnitude of impact"
              },
              "mitigation_strategy": {
                "type": "string",
                "description": "How to address or reduce this risk"
              }
            },
            "required": ["factor", "probability", "impact"]
          }
        },
        "maximum_drawdown_estimate": {
          "type": "number",
          "description": "Estimated maximum potential loss as percentage"
        },
        "tail_risk_assessment": {
          "type": "string",
          "description": "Analysis of extreme adverse scenarios"
        }
      },
      "required": ["overall_risk_level", "risk_factors"]
    },
    "scenario_analysis": {
      "type": "object",
      "properties": {
        "base_case": {
          "type": "object",
          "properties": {
            "probability": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0
            },
            "outcome_description": {
              "type": "string"
            },
            "expected_return": {
              "type": "number",
              "description": "Expected return as percentage"
            }
          },
          "required": ["probability", "outcome_description"]
        },
        "bull_case": {
          "type": "object",
          "properties": {
            "probability": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0
            },
            "outcome_description": {
              "type": "string"
            },
            "expected_return": {
              "type": "number",
              "description": "Expected return as percentage"
            },
            "catalysts": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          "required": ["probability", "outcome_description"]
        },
        "bear_case": {
          "type": "object",
          "properties": {
            "probability": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0
            },
            "outcome_description": {
              "type": "string"
            },
            "expected_return": {
              "type": "number",
              "description": "Expected return as percentage (negative for losses)"
            },
            "catalysts": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          "required": ["probability", "outcome_description"]
        }
      },
      "required": ["base_case"]
    },
    "comparative_analysis": {
      "type": "object",
      "properties": {
        "alternative_strategies": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "strategy_name": {
                "type": "string"
              },
              "description": {
                "type": "string"
              },
              "risk_reward_comparison": {
                "type": "string"
              },
              "relative_merit": {
                "type": "string",
                "enum": ["SUPERIOR", "COMPARABLE", "INFERIOR"]
              }
            },
            "required": ["strategy_name", "description", "risk_reward_comparison", "relative_merit"]
          }
        },
        "market_alternatives": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "alternative_instrument": {
                "type": "string"
              },
              "rationale": {
                "type": "string"
              },
              "comparison": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "exit_strategy": {
      "type": "object",
      "properties": {
        "profit_targets": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "target_price": {
                "type": "number"
              },
              "percentage_gain": {
                "type": "number"
              },
              "exit_trigger": {
                "type": "string"
              }
            }
          }
        },
        "stop_loss_conditions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "trigger_level": {
                "type": "number"
              },
              "condition_description": {
                "type": "string"
              },
              "rationale": {
                "type": "string"
              }
            }
          }
        },
        "time_based_exits": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "timeframe": {
                "type": "string"
              },
              "exit_condition": {
                "type": "string"
              },
              "rationale": {
                "type": "string"
              }
            }
          }
        },
        "contingency_exits": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "event_trigger": {
                "type": "string"
              },
              "exit_action": {
                "type": "string"
              },
              "probability_weighting": {
                "type": "number",
                "minimum": 0.0,
                "maximum": 1.0
              }
            }
          }
        }
      }
    },
    "recommendation": {
      "type": "object",
      "properties": {
        "action": {
          "type": "string",
          "enum": ["BUY", "SELL", "HOLD", "AVOID", "MONITOR"],
          "description": "Primary recommendation"
        },
        "confidence_score": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        },
        "position_sizing_guidance": {
          "type": "string",
          "description": "Recommended position size relative to portfolio"
        },
        "urgency_level": {
          "type": "string",
          "enum": ["IMMEDIATE", "HIGH", "MODERATE", "LOW"],
          "description": "How quickly to act on this recommendation"
        },
        "key_assumptions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Critical assumptions underlying this recommendation"
        }
      },
      "required": ["action", "confidence_score"]
    },
    "metadata": {
      "type": "object",
      "properties": {
        "model_version": {
          "type": "string",
          "description": "LLM model and version used"
        },
        "processing_time_seconds": {
          "type": "number",
          "description": "Time taken to generate this analysis"
        },
        "data_freshness": {
          "type": "string",
          "description": "Age of underlying data used"
        },
        "disclaimer": {
          "type": "string",
          "description": "Standard legal disclaimer"
        }
      }
    }
  },
  "required": ["trade_id", "timestamp", "analysis_confidence", "trade_rationale", "risk_assessment", "scenario_analysis", "recommendation"]
}